INFO - 11/15/20 13:35:33 - 0:00:00 - ============ Initialized logger ============
WARNING - 11/15/20 13:35:33 - 0:00:00 - Process rank: 3, device: cuda:3, n_gpu: 1, distributed training: True, 16-bits training: False
WARNING - 11/15/20 13:35:33 - 0:00:00 - Process rank: 1, device: cuda:1, n_gpu: 1, distributed training: True, 16-bits training: False
INFO - 11/15/20 13:35:33 - 0:00:00 - adam_epsilon: 1e-08
                                     alpha: None
                                     available_entities: candidates_only
                                     cache_dir: 
                                     clustering_domain: within_doc
                                     command: python src/main.py --local_rank=0 --data_dir '/local/coref_entity_linking/data/BC5CDR/' --model_type 'bert' --trained_model_dir '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/' --task_name 'cluster_linking' --output_dir '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/' --log_dir '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/logs/' --do_test --max_seq_length '128' --seq_embed_dim '128' --embed_pooling_strategy 'pool_highlighted_outputs' --concat_pooling_strategy 'pool_highlighted_outputs' --clustering_domain 'within_doc' --available_entities 'candidates_only' --k '16' --per_gpu_infer_batch '256' --logging_steps '25' --train_domains 'train' 'entity_documents' --val_domains 'val' 'entity_documents' --test_domains 'test' 'entity_documents'
                                     concat_pooling_strategy: pool_highlighted_outputs
                                     config_name: 
                                     data_dir: /local/coref_entity_linking/data/BC5CDR/
                                     device: cuda:0
                                     disable_logging: False
                                     do_lower_case: False
                                     do_test: True
                                     do_train: False
                                     do_train_eval: False
                                     do_val: False
                                     dump_coref_candidate_sets: False
                                     embed_pooling_strategy: pool_highlighted_outputs
                                     eval_all_checkpoints: False
                                     eval_coref_threshold: None
                                     evaluate_during_training: False
                                     fp16: False
                                     fp16_opt_level: O1
                                     git_hash: b0fe9113a21dab55328b6dd7b9fe8ef294242ebe
                                     gradient_accumulation_steps: 1
                                     k: 16
                                     knn_refresh_steps: 100
                                     learning_rate: 5e-05
                                     local_rank: 0
                                     log_dir: /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/logs/
                                     logging_steps: 25
                                     margin: None
                                     max_grad_norm: 1.0
                                     max_seq_length: 128
                                     max_steps: -1
                                     mention_negatives: candidates_only
                                     model_name_or_path: None
                                     model_type: bert
                                     n_gpu: 1
                                     no_cuda: False
                                     num_candidates: 64
                                     num_candidates_per_example: 16
                                     num_clusters_per_macro_batch: 8
                                     num_context_codes: 4
                                     num_dataloader_workers: 0
                                     num_train_epochs: 3
                                     num_train_negs: 32
                                     output_dir: /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/
                                     overwrite_cache: False
                                     overwrite_output_dir: False
                                     pair_gen_method: all_pairs
                                     per_gpu_infer_batch_size: 256
                                     per_gpu_train_batch_size: 8
                                     sample_size: None
                                     save_steps: 50
                                     seed: 42
                                     seq_embed_dim: 128
                                     server_ip: 
                                     server_port: 
                                     task_name: cluster_linking
                                     test_domains: ['test', 'entity_documents']
                                     test_mention_entity_scores: None
                                     tiny_experiment: False
                                     tokenizer_name: 
                                     train_domains: ['train', 'entity_documents']
                                     train_mention_entity_scores: None
                                     trained_model_dir: /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/
                                     training_edges_considered: all
                                     training_method: triplet_max_margin
                                     val_domains: ['val', 'entity_documents']
                                     val_mention_entity_scores: None
                                     warmup_steps: 0
                                     weight_decay: 0.0
                                     world_size: 4
INFO - 11/15/20 13:35:33 - 0:00:00 - The experiment will be stored in /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/
                                     
INFO - 11/15/20 13:35:33 - 0:00:00 - Running command: python src/main.py --local_rank=0 --data_dir '/local/coref_entity_linking/data/BC5CDR/' --model_type 'bert' --trained_model_dir '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/' --task_name 'cluster_linking' --output_dir '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/' --log_dir '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/logs/' --do_test --max_seq_length '128' --seq_embed_dim '128' --embed_pooling_strategy 'pool_highlighted_outputs' --concat_pooling_strategy 'pool_highlighted_outputs' --clustering_domain 'within_doc' --available_entities 'candidates_only' --k '16' --per_gpu_infer_batch '256' --logging_steps '25' --train_domains 'train' 'entity_documents' --val_domains 'val' 'entity_documents' --test_domains 'test' 'entity_documents'
                                     
WARNING - 11/15/20 13:35:33 - 0:00:00 - Process rank: 0, device: cuda:0, n_gpu: 1, distributed training: True, 16-bits training: False
INFO - 11/15/20 13:35:33 - 0:00:00 - Creating models.
INFO - 11/15/20 13:35:33 - 0:00:00 - Model name '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model' not found in model shortcut name list (bert-base-uncased, bert-large-uncased, bert-base-cased, bert-large-cased, bert-base-multilingual-uncased, bert-base-multilingual-cased, bert-base-chinese, bert-base-german-cased, bert-large-uncased-whole-word-masking, bert-large-cased-whole-word-masking, bert-large-uncased-whole-word-masking-finetuned-squad, bert-large-cased-whole-word-masking-finetuned-squad, bert-base-cased-finetuned-mrpc, bert-base-german-dbmdz-cased, bert-base-german-dbmdz-uncased, TurkuNLP/bert-base-finnish-cased-v1, TurkuNLP/bert-base-finnish-uncased-v1, wietsedv/bert-base-dutch-cased). Assuming '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model' is a path, a model identifier, or url to a directory containing tokenizer files.
WARNING - 11/15/20 13:35:33 - 0:00:00 - Process rank: 2, device: cuda:2, n_gpu: 1, distributed training: True, 16-bits training: False
INFO - 11/15/20 13:35:33 - 0:00:00 - Didn't find file /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model/added_tokens.json. We won't load it.
INFO - 11/15/20 13:35:33 - 0:00:00 - loading file /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model/vocab.txt
INFO - 11/15/20 13:35:33 - 0:00:00 - loading file None
INFO - 11/15/20 13:35:33 - 0:00:00 - loading file /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model/special_tokens_map.json
INFO - 11/15/20 13:35:33 - 0:00:00 - loading file /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model/tokenizer_config.json
INFO - 11/15/20 13:35:33 - 0:00:00 - loading configuration file /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model/m_e_model/config.json
INFO - 11/15/20 13:35:33 - 0:00:00 - Model config BertConfig {
                                       "architectures": [
                                         "BertSequenceScoringModel"
                                       ],
                                       "attention_probs_dropout_prob": 0.1,
                                       "cls_id": 101,
                                       "concat_pooling_strategy": "cls",
                                       "end_entity_id": 4,
                                       "end_mention_id": 2,
                                       "finetuning_task": "cluster_linking",
                                       "hidden_act": "gelu",
                                       "hidden_dropout_prob": 0.1,
                                       "hidden_size": 768,
                                       "initializer_range": 0.02,
                                       "intermediate_size": 3072,
                                       "layer_norm_eps": 1e-12,
                                       "max_position_embeddings": 512,
                                       "model_type": "bert",
                                       "num_attention_heads": 12,
                                       "num_hidden_layers": 12,
                                       "pad_token_id": 0,
                                       "sep_id": 102,
                                       "start_entity_id": 3,
                                       "start_mention_id": 1,
                                       "type_vocab_size": 2,
                                       "vocab_size": 28996
                                     }
                                     
INFO - 11/15/20 13:35:33 - 0:00:00 - loading weights file /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model/m_e_model/pytorch_model.bin
INFO - 11/15/20 13:35:37 - 0:00:04 - loading configuration file /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model/m_m_model/config.json
INFO - 11/15/20 13:35:37 - 0:00:04 - Model config BertConfig {
                                       "architectures": [
                                         "BertSequenceScoringModel"
                                       ],
                                       "attention_probs_dropout_prob": 0.1,
                                       "cls_id": 101,
                                       "concat_pooling_strategy": "pool_highlighted_outputs",
                                       "end_entity_id": 4,
                                       "end_mention_id": 2,
                                       "finetuning_task": "cluster_linking",
                                       "hidden_act": "gelu",
                                       "hidden_dropout_prob": 0.1,
                                       "hidden_size": 768,
                                       "initializer_range": 0.02,
                                       "intermediate_size": 3072,
                                       "layer_norm_eps": 1e-12,
                                       "max_position_embeddings": 512,
                                       "model_type": "bert",
                                       "num_attention_heads": 12,
                                       "num_hidden_layers": 12,
                                       "pad_token_id": 0,
                                       "sep_id": 102,
                                       "start_entity_id": 3,
                                       "start_mention_id": 1,
                                       "type_vocab_size": 2,
                                       "vocab_size": 28996
                                     }
                                     
INFO - 11/15/20 13:35:37 - 0:00:04 - loading weights file /mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/affinity_model_model/m_m_model/pytorch_model.bin
INFO - 11/15/20 13:35:41 - 0:00:09 - Loading cached metadata and dataset.
INFO - 11/15/20 13:35:53 - 0:00:21 - Training/evaluation parameters Namespace(adam_epsilon=1e-08, alpha=None, available_entities='candidates_only', cache_dir='', clustering_domain='within_doc', command="python src/main.py --local_rank=0 --data_dir '/local/coref_entity_linking/data/BC5CDR/' --model_type 'bert' --trained_model_dir '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/' --task_name 'cluster_linking' --output_dir '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/' --log_dir '/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/logs/' --do_test --max_seq_length '128' --seq_embed_dim '128' --embed_pooling_strategy 'pool_highlighted_outputs' --concat_pooling_strategy 'pool_highlighted_outputs' --clustering_domain 'within_doc' --available_entities 'candidates_only' --k '16' --per_gpu_infer_batch '256' --logging_steps '25' --train_domains 'train' 'entity_documents' --val_domains 'val' 'entity_documents' --test_domains 'test' 'entity_documents'", concat_pooling_strategy='pool_highlighted_outputs', config_name='', data_dir='/local/coref_entity_linking/data/BC5CDR/', device=device(type='cuda', index=0), disable_logging=False, do_lower_case=False, do_test=True, do_train=False, do_train_eval=False, do_val=False, dump_coref_candidate_sets=False, embed_pooling_strategy='pool_highlighted_outputs', eval_all_checkpoints=False, eval_coref_threshold=None, evaluate_during_training=False, fp16=False, fp16_opt_level='O1', git_hash='b0fe9113a21dab55328b6dd7b9fe8ef294242ebe', gradient_accumulation_steps=1, infer_batch_size=256, k=16, knn_refresh_steps=100, learning_rate=5e-05, local_rank=0, log_dir='/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/logs/', logging_steps=25, margin=None, max_grad_norm=1.0, max_seq_length=128, max_steps=-1, mention_negatives='candidates_only', model_name_or_path=None, model_type='bert', n_gpu=1, no_cuda=False, num_candidates=64, num_candidates_per_example=16, num_clusters_per_macro_batch=8, num_context_codes=4, num_dataloader_workers=0, num_train_epochs=3, num_train_negs=32, output_dir='/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/', overwrite_cache=False, overwrite_output_dir=False, pair_gen_method='all_pairs', per_gpu_infer_batch_size=256, per_gpu_train_batch_size=8, sample_size=None, save_steps=50, seed=42, seq_embed_dim=128, server_ip='', server_port='', task_name='cluster_linking', test_cache_dir='/local/coref_entity_linking/data/BC5CDR/cache/test', test_domains=['test', 'entity_documents'], test_mention_entity_scores=None, tiny_experiment=False, tokenizer=<transformers.tokenization_bert.BertTokenizer object at 0x2aab1e2a6d10>, tokenizer_name='', train_batch_size=8, train_domains=['train', 'entity_documents'], train_mention_entity_scores=None, trained_model_dir='/mnt/nfs/scratch1/rangell/lerac/coref_entity_linking/experiments/BC5CDR/cluster_linking/exp_1/checkpoint-398/', training_edges_considered='all', training_method='triplet_max_margin', val_domains=['val', 'entity_documents'], val_mention_entity_scores=None, warmup_steps=0, weight_decay=0.0, world_size=4)
INFO - 11/15/20 13:35:53 - 0:00:21 - Creating sub-trainers.
INFO - 11/15/20 13:35:53 - 0:00:21 - Successfully created trainer object
INFO - 11/15/20 13:35:53 - 0:00:21 - ********** [START] eval: test **********
INFO - 11/15/20 13:35:53 - 0:00:21 - Building within doc sparse graphs...
INFO - 11/15/20 14:24:58 - 0:49:25 - Done.
INFO - 11/15/20 14:24:58 - 0:49:25 - Computing coref metrics...
INFO - 11/15/20 14:24:59 - 0:49:26 - Generating candidate thresholds...
INFO - 11/15/20 14:25:11 - 0:49:38 - Done.
INFO - 11/15/20 14:25:11 - 0:49:38 - Choosing threshold...
INFO - 11/15/20 14:26:49 - 0:51:16 - Done.
INFO - 11/15/20 14:26:50 - 0:51:17 - Done.
INFO - 11/15/20 14:26:50 - 0:51:17 - Computing linking metrics...
INFO - 11/15/20 14:26:52 - 0:51:19 - Done.
INFO - 11/15/20 14:26:52 - 0:51:19 - Computing joint metrics...
INFO - 11/15/20 14:27:04 - 0:51:31 - Done.
INFO - 11/15/20 14:27:06 - 0:51:33 - {'test_concat_coref_fmi': 0.9508464228121463, 'test_concat_coref_rand_index': 0.9507082046028336, 'test_concat_coref_threshold': 1.5150188207626343, 'test_concat_vanilla_recall': 0.9594179135068661, 'test_concat_vanilla_accuracy': 0.8767165402746464, 'test_concat_joint_accuracy': 0.8652387784382045, 'test_concat_joint_cc_recall': 0.9383070301291249}
INFO - 11/15/20 14:27:06 - 0:51:33 - ********** [END] eval: test **********
